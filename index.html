<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metallotoxin Analyzer</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #5d3587; /* A shade of purple */
        }
    </style>
</head>
<body class="text-gray-900 antialiased p-4">

    <!-- Main Container -->
    <div class="max-w-xl mx-auto py-8">
        <header class="text-center mb-10">
            <div class="flex flex-col sm:flex-row items-center justify-center sm:justify-start mb-4">
                <!-- University Logo and Info -->
                <div class="flex-shrink-0 mb-4 sm:mb-0 sm:mr-4 text-center">
                    <img src="REC Logo.png" alt="Rajalakshmi Engineering College Logo" class="w-24 h-auto mx-auto mb-2 rounded-lg">
                    <p class="text-xs text-white font-semibold">Department of Food Technology</p>
                </div>
                <!-- Title and Subtitle -->
                <div class="text-center sm:text-left">
                    <h1 class="text-3xl sm:text-4xl font-extrabold text-white">Metallotoxin Analyzer</h1>
                    <p class="text-white mt-2">Heavy Metal Detection System</p>
                    <p class="text-white mt-2 text-sm font-bold text-lg">Developed By Tharini R.K, Varsha K & Tejesvi TT.</p>
                    <p class="text-white text-sm">Mentor: Mr. R. ANAND, Assistant Professor, Food Tech, REC.</p>
                </div>
            </div>
        </header>

        <!-- Analyzer Status Section -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-xl font-bold mb-4">Analyzer Status</h2>
            <div id="connectionStatus" class="flex items-center gap-3">
                <span class="inline-block w-3 h-3 rounded-full bg-red-500"></span>
                <span class="text-gray-700 font-semibold">Disconnected</span>
            </div>
            <div class="mt-4 text-sm text-gray-600">
                This interface can be connected to the analyzer via a wired connection (e.g., USB-C).
                In a real-world scenario, you would use the Web Serial API or a similar method
                to read data directly from the device.
            </div>
        </div>

        <!-- Action Section -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-xl font-bold mb-4">Actions</h2>
            
            <!-- Sample Type Selection -->
            <div class="mb-4">
                <label for="sampleType" class="block text-sm font-medium text-gray-700 mb-1">Select Sample Type</label>
                <select id="sampleType" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                    <option value="milk">Milk</option>
                    <option value="water">Water</option>
                    <option value="beverages">Beverages</option>
                </select>
            </div>

            <!-- Buttons -->
            <div class="flex flex-col sm:flex-row gap-4">
                <button id="calibrateButton" class="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 focus:ring-offset-gray-900">
                    Calibrate
                </button>
                <button id="standardButton" class="w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 focus:ring-offset-gray-900">
                    Read Standard
                </button>
                <button id="sampleButton" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-gray-900">
                    Read Sample
                </button>
            </div>
            <p id="loadingIndicator" class="mt-4 text-center text-sm text-gray-500 hidden">
                Reading in progress...
            </p>
        </div>

        <!-- Results Display Section -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-bold mb-4">Measurement Results</h2>
            <div class="space-y-4">
                <!-- Absorbance -->
                <div class="bg-gray-200 rounded-lg p-4 flex justify-between items-center">
                    <span class="text-gray-700">Absorbance (510nm)</span>
                    <span id="absorbanceValue" class="text-lg font-bold text-gray-900">--</span>
                </div>
                <!-- Cadmium Concentration -->
                <div id="cadmiumResult" class="bg-gray-200 rounded-lg p-4 flex justify-between items-center">
                    <span class="text-gray-700">Cadmium (Cd)</span>
                    <span id="cadmiumValue" class="text-lg font-bold text-gray-900">--</span>
                </div>
                <!-- Lead Concentration -->
                <div id="leadResult" class="bg-gray-200 rounded-lg p-4 flex justify-between items-center">
                    <span class="text-gray-700">Lead (Pb)</span>
                    <span id="leadValue" class="text-lg font-bold text-gray-900">--</span>
                </div>
            </div>
            <!-- Overall Status -->
            <div class="mt-6 p-4 rounded-lg text-center" id="statusBox">
                <span id="overallStatus" class="font-bold text-lg">Awaiting Reading...</span>
            </div>
        </div>
    </div>

    <!-- JavaScript for functionality -->
    <script>
        window.onload = function() {
            const calibrateButton = document.getElementById('calibrateButton');
            const standardButton = document.getElementById('standardButton');
            const sampleButton = document.getElementById('sampleButton');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const connectionStatus = document.getElementById('connectionStatus');
            const absorbanceValue = document.getElementById('absorbanceValue');
            const cadmiumValue = document.getElementById('cadmiumValue');
            const leadValue = document.getElementById('leadValue');
            const overallStatus = document.getElementById('overallStatus');
            const statusBox = document.getElementById('statusBox');
            const sampleTypeSelect = document.getElementById('sampleType');

            // Simulate initial connection success after a short delay
            setTimeout(() => {
                connectionStatus.innerHTML = '<span class="inline-block w-3 h-3 rounded-full bg-green-500"></span><span class="text-gray-700 font-semibold">Connected</span>';
            }, 1000);

            // Function to handle reading and updating the UI
            function performReading(isStandard, isCalibration) {
                // Show loading indicator and disable all buttons
                loadingIndicator.classList.remove('hidden');
                calibrateButton.disabled = true;
                standardButton.disabled = true;
                sampleButton.disabled = true;

                // Simulate an asynchronous reading process
                setTimeout(() => {
                    let abs, cd, pb;

                    if (isCalibration) {
                        overallStatus.textContent = "Calibration Complete";
                        statusBox.classList.remove('bg-red-500', 'bg-green-500');
                        statusBox.classList.add('bg-gray-200');
                        absorbanceValue.textContent = "0.000 Abs";
                        cadmiumValue.textContent = "--";
                        leadValue.textContent = "--";
                    } else if (isStandard) {
                        // Fixed values for standard reading
                        abs = (0.05 + Math.random() * 0.01).toFixed(3);
                        cd = (0.005 + Math.random() * 0.001).toFixed(3);
                        pb = (0.008 + Math.random() * 0.001).toFixed(3);

                        overallStatus.textContent = "Standard Reading Complete";
                        statusBox.classList.remove('bg-red-500', 'bg-green-500');
                        statusBox.classList.add('bg-gray-200');
                        absorbanceValue.textContent = `${abs} Abs`;
                        cadmiumValue.textContent = `${cd} ppm`;
                        leadValue.textContent = `${pb} ppm`;
                    } else {
                        // Random values for sample reading
                        abs = (Math.random() * 0.5).toFixed(3);
                        cd = (Math.random() * 0.1).toFixed(3);
                        pb = (Math.random() * 0.1).toFixed(3);

                        // Check for adulteration based on threshold
                        const isAdulterated = (parseFloat(cd) > 0.05) || (parseFloat(pb) > 0.05);
                        if (isAdulterated) {
                            overallStatus.textContent = "Adulteration Detected";
                            statusBox.classList.remove('bg-gray-200', 'bg-green-500');
                            statusBox.classList.add('bg-red-500');
                        } else {
                            overallStatus.textContent = "Safe to Consume";
                            statusBox.classList.remove('bg-gray-200', 'bg-red-500');
                            statusBox.classList.add('bg-green-500');
                        }

                        // Update the values on the page
                        absorbanceValue.textContent = `${abs} Abs`;
                        cadmiumValue.textContent = `${cd} ppm`;
                        leadValue.textContent = `${pb} ppm`;
                    }
                    
                    // Hide loading indicator and re-enable buttons
                    loadingIndicator.classList.add('hidden');
                    calibrateButton.disabled = false;
                    standardButton.disabled = false;
                    sampleButton.disabled = false;
                }, 2000); // Simulate a 2-second reading time
            }

            calibrateButton.addEventListener('click', () => {
                performReading(false, true); // It's a calibration reading
            });

            standardButton.addEventListener('click', () => {
                performReading(true, false); // It's a standard reading
            });

            sampleButton.addEventListener('click', () => {
                performReading(false, false); // It's a sample reading
            });

            // The change event listener is no longer needed since both results are always displayed.
        };
    </script>
</body>
</html>
